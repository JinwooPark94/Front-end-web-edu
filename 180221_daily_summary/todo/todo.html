<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Todos V0</title>
  <link rel="stylesheet" href="./css/style.css">
</head>

<body>
  <section>
    <h1>Todolist</h1>
    <div>
      <a href="#" id="all-complt">전체선택 및 해제</a>
      <p id="count-complt"></p>
    </div>
    <ul id="todo-list"></ul>
    <form action="#">
      <input type="text" id="input-todo" placeholder="What needs to be done?" autofocus required>
    </form>
  </section>
  <script>
    var todosData = [ { id: 0, value : 'HTML', completed: true, date: '02-20'} ,
                      { id: 1, value: 'CSS', completed: false, date: '02-20'},
                      { id: 2, value: 'Javascript', completed : true, date: '02-20'} ];

    var elem = document.querySelector('#input-todo');
    var ul = document.querySelector('#todo-list');
    var countP = document.querySelector('#count-complt');
    var allComP = document.querySelector('#all-complt');

    var idValue = todosData.length;

    function addData(e){
      if (elem.value) {
        if (e.keyCode === 13) {
          var newData = { id: idValue, value: elem.value, completed: false, date: getMonthDate()};
          todosData.push(newData);

          ul.innerHTML = '';
          updateData();
          elem.value = '';

          idValue++;
        }
      }
    }

    function updateData() {
      ul.innerHTML = '';
      var todosData2 = todosData.forEach(function (item) {
        var dateShow = item.date.split('-');
        var checked = (item.completed === true) ? 'checked' : '';

        ul.innerHTML += '<li id=' + item.id + ' class='+ checked +'><input id="chk_' + item.id + '" class="chk_input" type="checkbox" ' + checked + '>' + item.value + '<span>' + dateShow[0] + '월 ' + dateShow[1] + '일' + '</span><i class="icon-cancel"></i></li>';
      });

      countP.innerHTML = '총 ' + completeCount() + '항목 완료';
    }

    function deleteData(e) {
      if (e.target.nodeName == 'I') {
        deleteId = Number.parseInt(e.target.offsetParent.id);
        todosData = todosData.filter(function (todo) {
          return todo.id !== deleteId
        });

        //delete todosData[deleteId];
        //todosData.splice(deleteId, 1);

        ul.innerHTML = '';
        updateData();
      }
    }

    function completeCount() {
      var count = 0;
      todosData.forEach(function (item) {
        if (item.completed === true) count++;
      });
      return count
    }

    function getMonthDate() {
      var today = new Date();
      var month = today.getMonth() + 1;
      date = today.getDate();

      month = month < 10 ? '0' + month : month;

      return month + '-' + date;
    }

    function completeAll() {
      var trueVal = 0;

      todosData.forEach(function (item) {
        (item.completed === true) ? trueVal++ : 0;
      });

      if ( trueVal !== todosData.length ) {
        todosData.map( function (item) {
          item.completed = true;
        });
      } else{
        todosData.map(function (item) {
          item.completed = false;
        });
      }

    }

    function checkboxUpd(e) {
      var chkId = e.target.id;
      chkId = chkId.substring(4, e.target.id.length) * 1;

      todosData.forEach(function (item) {
        if (item.id === chkId) item.completed = !item.completed
      });

      updateData();
    }


    window.addEventListener('load', function (e) {
      updateData();
    });

    elem.addEventListener('keyup', function (e) {
      addData(e);
    });

    ul.addEventListener('click', function (e) {
      deleteData(e);
    });

    ul.addEventListener('change', function (e) {
      checkboxUpd(e);
    });

    allComP.addEventListener('click', function (e) {
      completeAll();
      updateData();
    });

  </script>
</body>
</html>